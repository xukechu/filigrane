// Translations for the Image Watermark Tool
// Supported languages: English, French, German, Italian, Spanish, Japanese, Russian, Arabic, Simplified Chinese, Traditional Chinese, Korean

const translations = {
    // English (default)
    'en': {
        'pageTitle': 'Image Watermark Tool',
        'mainHeading': 'Image Watermark Tool',
        'selectImage': 'Select an image or drag & drop here',
        'uploadPrompt': 'Click to upload or drag an image here',
        'watermarkText': 'Watermark Text',
        'position': 'Position',
        'appearance': 'Appearance',
        'topLeft': 'Top Left',
        'topRight': 'Top Right',
        'center': 'Center',
        'bottomLeft': 'Bottom Left',
        'bottomRight': 'Bottom Right',
        'xOffset': 'X Offset:',
        'yOffset': 'Y Offset:',
        'fontSize': 'Font Size:',
        'opacity': 'Opacity:',
        'color': 'Color:',
        'rotation': 'Rotation:',
        'downloadBtn': 'Download Image',
        'watermarkDefault': 'Watermark',
        'enterWatermarkText': 'Enter watermark text',
        'downloadFilename': 'watermarked-image.png',
        'pixelUnit': 'px',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': 'Re-upload',
        'dir': 'ltr' // text direction: ltr (left to right) or rtl (right to left)
    },
    // French
    'fr': {
        'pageTitle': 'Outil de Filigrane d\'Image',
        'mainHeading': 'Outil de Filigrane d\'Image',
        'selectImage': 'Sélectionnez une image pour ajouter un filigrane',
        'uploadPrompt': 'Téléchargez une image pour ajouter un filigrane',
        'watermarkText': 'Texte du Filigrane',
        'position': 'Position',
        'appearance': 'Apparence',
        'topLeft': 'En Haut à Gauche',
        'topRight': 'En Haut à Droite',
        'center': 'Centre',
        'bottomLeft': 'En Bas à Gauche',
        'bottomRight': 'En Bas à Droite',
        'xOffset': 'Décalage X:',
        'yOffset': 'Décalage Y:',
        'fontSize': 'Taille de Police:',
        'opacity': 'Opacité:',
        'color': 'Couleur:',
        'rotation': 'Rotation:',
        'downloadBtn': 'Télécharger l\'Image',
        'watermarkDefault': 'Filigrane',
        'enterWatermarkText': 'Entrez le texte du filigrane',
        'downloadFilename': 'image-filigranee.png',
        'pixelUnit': 'px',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': 'Re-télécharger',
        'dir': 'ltr'
    },
    // German
    'de': {
        'pageTitle': 'Bild-Wasserzeichen-Tool',
        'mainHeading': 'Bild-Wasserzeichen-Tool',
        'selectImage': 'Wählen Sie ein Bild aus, um ein Wasserzeichen hinzuzufügen',
        'uploadPrompt': 'Laden Sie ein Bild hoch, um ein Wasserzeichen hinzuzufügen',
        'watermarkText': 'Wasserzeichen-Text',
        'position': 'Position',
        'appearance': 'Aussehen',
        'topLeft': 'Oben Links',
        'topRight': 'Oben Rechts',
        'center': 'Mitte',
        'bottomLeft': 'Unten Links',
        'bottomRight': 'Unten Rechts',
        'xOffset': 'X-Versatz:',
        'yOffset': 'Y-Versatz:',
        'fontSize': 'Schriftgröße:',
        'opacity': 'Deckkraft:',
        'color': 'Farbe:',
        'rotation': 'Drehung:',
        'downloadBtn': 'Bild Herunterladen',
        'watermarkDefault': 'Wasserzeichen',
        'enterWatermarkText': 'Wasserzeichen-Text eingeben',
        'downloadFilename': 'wasserzeichen-bild.png',
        'pixelUnit': 'px',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': 'Neu hochladen',
        'dir': 'ltr'
    },
    // Italian
    'it': {
        'pageTitle': 'Strumento Filigrana Immagine',
        'mainHeading': 'Strumento Filigrana Immagine',
        'selectImage': 'Seleziona un\'immagine per aggiungere una filigrana',
        'uploadPrompt': 'Carica un\'immagine per aggiungere una filigrana',
        'watermarkText': 'Testo Filigrana',
        'position': 'Posizione',
        'appearance': 'Aspetto',
        'topLeft': 'In Alto a Sinistra',
        'topRight': 'In Alto a Destra',
        'center': 'Centro',
        'bottomLeft': 'In Basso a Sinistra',
        'bottomRight': 'In Basso a Destra',
        'xOffset': 'Offset X:',
        'yOffset': 'Offset Y:',
        'fontSize': 'Dimensione Font:',
        'opacity': 'Opacità:',
        'color': 'Colore:',
        'rotation': 'Rotazione:',
        'downloadBtn': 'Scarica Immagine',
        'watermarkDefault': 'Filigrana',
        'enterWatermarkText': 'Inserisci testo filigrana',
        'downloadFilename': 'immagine-filigranata.png',
        'pixelUnit': 'px',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': 'Ricarica',
        'dir': 'ltr'
    },
    // Spanish
    'es': {
        'pageTitle': 'Herramienta de Marca de Agua de Imagen',
        'mainHeading': 'Herramienta de Marca de Agua de Imagen',
        'selectImage': 'Seleccione una imagen para añadir una marca de agua',
        'uploadPrompt': 'Suba una imagen para añadir una marca de agua',
        'watermarkText': 'Texto de Marca de Agua',
        'position': 'Posición',
        'appearance': 'Apariencia',
        'topLeft': 'Arriba Izquierda',
        'topRight': 'Arriba Derecha',
        'center': 'Centro',
        'bottomLeft': 'Abajo Izquierda',
        'bottomRight': 'Abajo Derecha',
        'xOffset': 'Desplazamiento X:',
        'yOffset': 'Desplazamiento Y:',
        'fontSize': 'Tamaño de Fuente:',
        'opacity': 'Opacidad:',
        'color': 'Color:',
        'rotation': 'Rotación:',
        'downloadBtn': 'Descargar Imagen',
        'watermarkDefault': 'Marca de Agua',
        'enterWatermarkText': 'Introduzca texto de marca de agua',
        'downloadFilename': 'imagen-con-marca.png',
        'pixelUnit': 'px',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': 'Volver a subir',
        'dir': 'ltr'
    },
    // Japanese
    'ja': {
        'pageTitle': '画像透かしツール',
        'mainHeading': '画像透かしツール',
        'selectImage': '透かしを追加する画像を選択',
        'uploadPrompt': '透かしを追加する画像をアップロード',
        'watermarkText': '透かしテキスト',
        'position': '位置',
        'appearance': '外観',
        'topLeft': '左上',
        'topRight': '右上',
        'center': '中央',
        'bottomLeft': '左下',
        'bottomRight': '右下',
        'xOffset': 'X オフセット:',
        'yOffset': 'Y オフセット:',
        'fontSize': 'フォントサイズ:',
        'opacity': '不透明度:',
        'color': '色:',
        'rotation': '回転:',
        'downloadBtn': '画像をダウンロード',
        'watermarkDefault': '透かし',
        'enterWatermarkText': '透かしテキストを入力',
        'downloadFilename': '透かし入り画像.png',
        'pixelUnit': 'px',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': '再アップロード',
        'dir': 'ltr'
    },
    // Russian
    'ru': {
        'pageTitle': 'Инструмент Водяных Знаков',
        'mainHeading': 'Инструмент Водяных Знаков',
        'selectImage': 'Выберите изображение для добавления водяного знака',
        'uploadPrompt': 'Загрузите изображение для добавления водяного знака',
        'watermarkText': 'Текст Водяного Знака',
        'position': 'Позиция',
        'appearance': 'Внешний Вид',
        'topLeft': 'Верхний Левый',
        'topRight': 'Верхний Правый',
        'center': 'Центр',
        'bottomLeft': 'Нижний Левый',
        'bottomRight': 'Нижний Правый',
        'xOffset': 'Смещение X:',
        'yOffset': 'Смещение Y:',
        'fontSize': 'Размер Шрифта:',
        'opacity': 'Прозрачность:',
        'color': 'Цвет:',
        'rotation': 'Вращение:',
        'downloadBtn': 'Скачать Изображение',
        'watermarkDefault': 'Водяной Знак',
        'enterWatermarkText': 'Введите текст водяного знака',
        'downloadFilename': 'изображение-с-водяным-знаком.png',
        'pixelUnit': 'пкс',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': 'Перезагрузить',
        'dir': 'ltr'
    },
    // Arabic
    'ar': {
        'pageTitle': 'أداة العلامة المائية للصور',
        'mainHeading': 'أداة العلامة المائية للصور',
        'selectImage': 'حدد صورة لإضافة علامة مائية',
        'uploadPrompt': 'قم بتحميل صورة لإضافة علامة مائية',
        'watermarkText': 'نص العلامة المائية',
        'position': 'الموضع',
        'appearance': 'المظهر',
        'topLeft': 'أعلى اليسار',
        'topRight': 'أعلى اليمين',
        'center': 'الوسط',
        'bottomLeft': 'أسفل اليسار',
        'bottomRight': 'أسفل اليمين',
        'xOffset': 'إزاحة X:',
        'yOffset': 'إزاحة Y:',
        'fontSize': 'حجم الخط:',
        'opacity': 'الشفافية:',
        'color': 'اللون:',
        'rotation': 'الدوران:',
        'downloadBtn': 'تحميل الصورة',
        'watermarkDefault': 'علامة مائية',
        'enterWatermarkText': 'أدخل نص العلامة المائية',
        'downloadFilename': 'صورة-بعلامة-مائية.png',
        'pixelUnit': 'بكسل',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': 'إعادة التحميل',
        'dir': 'rtl' // Right to left for Arabic
    },
    // Simplified Chinese
    'zh-CN': {
        'pageTitle': '图片水印工具',
        'mainHeading': '图片水印工具',
        'selectImage': '选择图片或拖放至此',
        'uploadPrompt': '点击上传或拖放图片至此',
        'watermarkText': '水印文本',
        'position': '位置',
        'appearance': '外观',
        'topLeft': '左上角',
        'topRight': '右上角',
        'center': '中心',
        'bottomLeft': '左下角',
        'bottomRight': '右下角',
        'xOffset': 'X 偏移:',
        'yOffset': 'Y 偏移:',
        'fontSize': '字体大小:',
        'opacity': '不透明度:',
        'color': '颜色:',
        'rotation': '旋转:',
        'downloadBtn': '下载图片',
        'watermarkDefault': '水印',
        'enterWatermarkText': '输入水印文本',
        'downloadFilename': '带水印图片.png',
        'pixelUnit': '像素',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': '重新上传',
        'dir': 'ltr'
    },
    // Traditional Chinese
    'zh-TW': {
        'pageTitle': '圖片浮水印工具',
        'mainHeading': '圖片浮水印工具',
        'selectImage': '選擇一張圖片添加浮水印',
        'uploadPrompt': '上傳圖片添加浮水印',
        'watermarkText': '浮水印文字',
        'position': '位置',
        'appearance': '外觀',
        'topLeft': '左上角',
        'topRight': '右上角',
        'center': '中心',
        'bottomLeft': '左下角',
        'bottomRight': '右下角',
        'xOffset': 'X 偏移:',
        'yOffset': 'Y 偏移:',
        'fontSize': '字體大小:',
        'opacity': '不透明度:',
        'color': '顏色:',
        'rotation': '旋轉:',
        'downloadBtn': '下載圖片',
        'watermarkDefault': '浮水印',
        'enterWatermarkText': '輸入浮水印文字',
        'downloadFilename': '帶浮水印圖片.png',
        'pixelUnit': '像素',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': '重新上傳',
        'dir': 'ltr'
    },
    // Korean
    'ko': {
        'pageTitle': '이미지 워터마크 도구',
        'mainHeading': '이미지 워터마크 도구',
        'selectImage': '워터마크를 추가할 이미지 선택',
        'uploadPrompt': '워터마크를 추가할 이미지 업로드',
        'watermarkText': '워터마크 텍스트',
        'position': '위치',
        'appearance': '모양',
        'topLeft': '왼쪽 상단',
        'topRight': '오른쪽 상단',
        'center': '중앙',
        'bottomLeft': '왼쪽 하단',
        'bottomRight': '오른쪽 하단',
        'xOffset': 'X 오프셋:',
        'yOffset': 'Y 오프셋:',
        'fontSize': '글꼴 크기:',
        'opacity': '불투명도:',
        'color': '색상:',
        'rotation': '회전:',
        'downloadBtn': '이미지 다운로드',
        'watermarkDefault': '워터마크',
        'enterWatermarkText': '워터마크 텍스트 입력',
        'downloadFilename': '워터마크-이미지.png',
        'pixelUnit': '픽셀',
        'percentUnit': '%',
        'degreeUnit': '°',
        'reuploadBtn': '다시 업로드',
        'dir': 'ltr'
    }
};

// Language mapping for browser language codes
const languageMapping = {
    'en': 'en',
    'fr': 'fr',
    'de': 'de',
    'it': 'it',
    'es': 'es',
    'ja': 'ja',
    'ru': 'ru',
    'ar': 'ar',
    'zh-CN': 'zh-CN',
    'zh-TW': 'zh-TW',
    'zh': 'zh-CN', // Default Chinese to Simplified
    'ko': 'ko'
};

// Function to get user's browser language
function getBrowserLanguage() {
    const browserLang = navigator.language || navigator.userLanguage;
    const langCode = browserLang.split('-')[0]; // Get the primary language code

    // Check if we have an exact match for the full browser language
    if (translations[browserLang]) {
        return browserLang;
    }

    // Check if we have a mapping for this language
    if (languageMapping[browserLang]) {
        return languageMapping[browserLang];
    }

    // Check if we have a mapping for the primary language code
    if (languageMapping[langCode]) {
        return languageMapping[langCode];
    }

    // Default to English if no match found
    return 'en';
}

// Function to get translation for a key in the current language
function getTranslation(key) {
    const currentLang = getCurrentLanguage();
    return (translations[currentLang] && translations[currentLang][key]) || translations['en'][key];
}

// Function to get the current language
function getCurrentLanguage() {
    return localStorage.getItem('preferredLanguage') || getBrowserLanguage();
}

// Function to set the language
function setLanguage(langCode) {
    if (translations[langCode]) {
        localStorage.setItem('preferredLanguage', langCode);
        applyTranslations();

        // Update canvas text when language changes
        if (typeof updateCanvasText === 'function') {
            updateCanvasText();
        }

        return true;
    }
    return false;
}

// Function to apply translations to the UI
function applyTranslations() {
    const currentLang = getCurrentLanguage();
    const langData = translations[currentLang] || translations['en'];

    // Update page title
    document.title = langData.pageTitle;

    // Update main heading
    document.querySelector('h1').innerText = langData.mainHeading;

    // Update upload section
    document.querySelector('.upload-section p').innerText = langData.selectImage;

    // Update watermark text section
    document.querySelector('#watermarkTextTitle').innerText = langData.watermarkText;
    document.getElementById('watermarkText').placeholder = langData.enterWatermarkText;

    // Update position section
    document.querySelector('#positionTitle').innerText = langData.position;
    document.getElementById('posTopLeft').innerText = langData.topLeft;
    document.getElementById('posTopRight').innerText = langData.topRight;
    document.getElementById('posCenter').innerText = langData.center;
    document.getElementById('posBottomLeft').innerText = langData.bottomLeft;
    document.getElementById('posBottomRight').innerText = langData.bottomRight;

    // Update offset labels
    const xOffsetLabel = document.querySelector('.position-sliders label:nth-of-type(1)');
    xOffsetLabel.firstChild.innerText = langData.xOffset + ' ';

    const yOffsetLabel = document.querySelector('.position-sliders label:nth-of-type(2)');
    yOffsetLabel.firstChild.innerText = langData.yOffset + ' ';

    // Update appearance section
    document.querySelector('#appearanceTitle').innerText = langData.appearance;

    const fontSizeLabel = document.querySelector('#fontSizeLabel');
    fontSizeLabel.firstChild.textContent = langData.fontSize + ' ';

    const opacityLabel = document.querySelector('#opacityLabel');
    opacityLabel.firstChild.textContent = langData.opacity + ' ';

    const colorLabel = document.querySelector('#colorLabel');
    colorLabel.firstChild.textContent = langData.color + ' ';

    const rotationLabel = document.querySelector('#rotationLabel');
    rotationLabel.firstChild.textContent = langData.rotation + ' ';

    // Update download button
    document.getElementById('downloadBtn').innerText = langData.downloadBtn;

    // Update re-upload button
    document.getElementById('reuploadText').innerText = langData.reuploadBtn;

    // Update unit suffixes for font size, opacity, and rotation
    const fontSize = document.getElementById('fontSize');
    const opacity = document.getElementById('opacity');
    const rotation = document.getElementById('rotation');
    const fontSizeValue = document.getElementById('fontSizeValue');
    const opacityValue = document.getElementById('opacityValue');
    const rotationValue = document.getElementById('rotationValue');

    if (fontSize && fontSizeValue) {
        fontSizeValue.textContent = fontSize.value + langData.pixelUnit;
    }
    if (opacity && opacityValue) {
        opacityValue.textContent = opacity.value + langData.percentUnit;
    }
    if (rotation && rotationValue) {
        rotationValue.textContent = rotation.value + langData.degreeUnit;
    }

    // Set text direction for the whole document
    document.documentElement.dir = langData.dir;
    document.documentElement.lang = currentLang;
}

// Create language selector
function createLanguageSelector() {
    // Create language selector container
    const langSelector = document.createElement('div');
    langSelector.className = 'language-selector';
    langSelector.style.textAlign = 'right';
    langSelector.style.marginBottom = '10px';

    // Create select element
    const select = document.createElement('select');
    select.id = 'languageSelect';
    select.style.padding = '5px';
    select.style.borderRadius = '4px';

    // Add options for each language
    const languageNames = {
        'en': 'English',
        'fr': 'Français',
        'de': 'Deutsch',
        'it': 'Italiano',
        'es': 'Español',
        'ja': '日本語',
        'ru': 'Русский',
        'ar': 'العربية',
        'zh-CN': '简体中文',
        'zh-TW': '繁體中文',
        'ko': '한국어'
    };

    Object.keys(languageNames).forEach(langCode => {
        const option = document.createElement('option');
        option.value = langCode;
        option.innerText = languageNames[langCode];
        select.appendChild(option);
    });

    // Set the current language
    select.value = getCurrentLanguage();

    // Add event listener for language change
    select.addEventListener('change', function() {
        setLanguage(this.value);
    });

    // Add select to container
    langSelector.appendChild(select);

    // Insert the language selector at the top of the container
    const container = document.querySelector('.container');
    container.insertBefore(langSelector, container.firstChild);
}

// Initialize language support
function initLanguageSupport() {
    createLanguageSelector();
    applyTranslations();
}

// Call initLanguageSupport when the DOM is loaded
document.addEventListener('DOMContentLoaded', initLanguageSupport);
